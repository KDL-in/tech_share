# Docker Python源码加密

&nbsp;

# SJL
- **Docker：** 简单理解是一种开源的虚拟机技术，虽然和我们传统意义上的虚拟机不太一样，比较轻量。
  - 和传统虚拟机的最大区别是，传统虚拟机是在一个操作系统上跑一个虚拟机软件，然后在软件里面跑一个完整的操作系统。Linux启动到最后会挂载一个文件系统，我们在这个用户空间里面去操作。Docker原理就是新挂载这么一个新的文件系统，和当前操作系统共用一个内核空间。
  - 两个比较主要的概念就是镜像和容器，镜像可以由我们自己制作。它们之间的关系可以看做面向对象编程中的类和实例。这样的好处是，跟在一个系统下我们可以起很多个终端一样，我们可以同时起很多个docker。
  - 主要应用场景是，保证开发环境和部署环境的一致性。举个更具体的应用例子，日常中可能一个人要搞好几套代码。每套代码编译时，对工具链、环境的要求都不一样，甚至可能会有冲突的。我们又不可能给每个人在好几台环境不一样的服务器上都开帐号，资源不允许。所以可以在一台服务器中放多个docker镜像。用户通过进docker，在里面编译，就能比较好解决这个问题。启动和挂载、退出，基本都是几秒搞定。
  - 对于普通使用者来说，自己制作镜像可能需要一定精力和学习。不过有很多已经做好的镜像可以用，仅仅只是使用docker的话就很容易了。

&nbsp;

- **Python源码加密：**
  - 可选方案
    - **pyc：** 门槛最低、也是网上找Python源码加密最容易找到的一种方式，平时运行的时候，也可能生成这种pyc文件。其实就是python一种根据相应的解释器版本生成的文件，可以优化运行速度。但破解门槛也非常低，目前已经有非常成熟的方法把它变回代码了，一个命令就能搞定那种。
      ```shell
      python3 -m compileall <src>
      ```
    - **代码混淆：** 这……很像那种C最难读懂代码比赛写出来的代码，有一些工具可以把你源码转得很难读。更加明显的然并卵，别人跑一下变成pyc，然后和上面一样就能拿到源码了。
    - **cython：** 这个比较有趣，它是先把Python代码转为C代码，然后就可以编译了。这样最终生成的东西，要破解就是汇编层面的东西了，相信我写的破代码和那个帐户密码还是没几个人会费心费力去干这事的。缺点也有，因为是C代码编译生成的，Python随处可用的特性就没了，换个环境，可能就要做针对性的重新编译；另外就是有可能转C代码失败，但我用了一段时间发现还好，至少比较常用的Python库都不会出现失败的情况，大不了只加密部分关键代码也行。
    - **解释器改造：** 这个门槛比较高，过程和部署也比较麻烦，但安全性最高。比起上面的奇技淫巧，这个才是真正的加密。原理是通过RSA之类的非对称加密来实现，Python是开源的，那么我们就能通过源码去改造解释器。直接在解释器里面加一key去解密代码，再写个工具加密代码。
  - 我最后是选了第三种cython，因为能基本解决安全问题、也容易实现；不像第四种，麻烦不说、还要去部署环境。
  - 然后我就写了一个shell工具脚本，实现功能大概是能够把一个文件 or 一整个Python项目目录 or 当前目录整体编译一遍。保证目录结构不变，但py文件全部变成 .so文件。留一个明文Python脚本做入口去import和调用那些so文件。
